name: Build Linguist for all platforms
description: ""
runs:
  using: composite
  steps:
    - uses: actions/setup-node@v2
      with:
        node-version: "14"

    - name: Install packages
      shell: bash
      run: npm install

    - name: Configure files
      shell: bash
      run: |
        cp .env.example .env

    - name: Restore third party artifacts
      id: cache-thirdparty-restore
      uses: actions/cache/restore@v4
      with:
        path: ./thirdparty/bergamot/build
        key: dbg1-${{ runner.os }}-${{ hashFiles('./thirdparty/bergamot/**') }}

    - name: Compile third party artifacts with docker
      if: steps.cache-thirdparty-restore.outputs.cache-hit != 'true'
      shell: bash
      run: make buildThirdparty

    - name: Save third party artifacts
      id: cache-thirdparty-save
      uses: actions/cache/save@v4
      with:
        path: ./thirdparty/bergamot/build
        key: ${{ steps.cache-thirdparty-restore.outputs.cache-primary-key }}

    - name: Build app
      shell: bash
      run: make prepare buildFirefox packAll lintBuilds
